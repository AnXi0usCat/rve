
# Save virtual environment path
__RVE_VIRTUAL_ENV="/Users/mihhailf/rust/rve/examples/examples/model-1/venv"
export VIRTUAL_ENV="$__RVE_VIRTUAL_ENV"

# Save old PATH
__RVE_OLD_PATH="$PATH"
export PATH="$__RVE_VIRTUAL_ENV/bin:$PATH"

# Save old PS1 if it exists
if [ -z "${__RVE_OLD_PS1:-}" ] && [ -n "${PS1:-}" ]; then
    __RVE_OLD_PS1="$PS1"
fi

# Modify the prompt if not disabled
if [ -z "${VIRTUAL_ENV_DISABLE_PROMPT:-}" ]; then
    PS1="($(basename "$__RVE_VIRTUAL_ENV")) ${PS1:-}"
    export PS1
fi

# Unset PYTHONHOME if it's set (and save it)
if [ -n "${PYTHONHOME:-}" ]; then
    __RVE_OLD_PYTHONHOME="$PYTHONHOME"
    unset PYTHONHOME
fi

# Rehash shell PATH cache to pick up changes
hash -r 2>/dev/null

# Define deactivate function to restore environment
deactivate () {
    # Restore old PATH
    if [ -n "${__RVE_OLD_PATH:-}" ]; then
        export PATH="$__RVE_OLD_PATH"
        unset __RVE_OLD_PATH
    fi

    # Restore old PS1
    if [ -n "${__RVE_OLD_PS1:-}" ]; then
        export PS1="$__RVE_OLD_PS1"
        unset __RVE_OLD_PS1
    fi

    # Restore PYTHONHOME if previously set
    if [ -n "${__RVE_OLD_PYTHONHOME:-}" ]; then
        export PYTHONHOME="$__RVE_OLD_PYTHONHOME"
        unset __RVE_OLD_PYTHONHOME
    fi

    # Unset VIRTUAL_ENV
    unset VIRTUAL_ENV

    # Rehash shell PATH cache again after deactivation
    hash -r 2>/dev/null

    # Unset the deactivate function itself
    unset -f deactivate
}

# Export deactivate function
export -f deactivate > /dev/null
